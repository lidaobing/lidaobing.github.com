---
layout: post
name: tdd-bdd
title: 从 TDD 到 BDD
date: 2010-07-18 00:40:00.000000000 +08:00
tags: tdd bdd rspec
permalink: /2010/07/tdd-bdd.html
---
<div xmlns='http://www.w3.org/1999/xhtml'>最近在学 ruby, 也用了 rspec, 传统的 xUnit 是 TDD 指导思想下的产物, 而 rspec 则算是 <b>BDD</b> (Behavior Driven Development) 影响下的产品。<br/><br/>TDD 和 BDD 区别究竟何在呢？<br/><br/>首先是思路上的区别, 传统的 TDD 关注的是接口是否被正确地实现了, 所以通常每个接口有一个对应的单元测试函数。而 <b>BDD 通常以类为单位, 关注一个类是否实现了文档定义的行为</b>。<br/><br/>具体从 rspec 的实现上来看, 主要有如下的不同<br/><br/><b>1. rspec 可以成为设计的一部分</b> , 你在设计一个类的时候, 一般会先写这个类需要实现哪些功能, 然后在逐个实现需求,  <br/>比如 XmlParser, 你会先计划他有三个特性, 支持从字符串初始化, 支持"=="符号, 支持序列化为字符串, <br/>这时候你就可以写下如下的测试代码<br/><br/><br/><br/># xml_parser_spec.rb<br/><br/>describe "XmlParser" do<br/><br/>  it "should support init with string"<br/><br/>  it "should support =="<br/><br/>  it "should can convert to string"<b><br/><br/></b>end<br/><br/><br/><br/>此时运行如下的命令就可以看到你规划的类行为<br/><br/>$ spec -f n xml_parser_spec.rb<br/><br/>XmlParser<br/><br/>  should support init with string (PENDING: Not Yet Implemented)<br/><br/>  should support == (PENDING: Not Yet Implemented)<br/><br/>  should can convert to string (PENDING: Not Yet Implemented)<br/><br/>...<br/><br/><br/><br/>上面的输出可以清晰地看到 XmlParser 需要支持的功能。你不用把这些功能需求记在脑子里, 也不放在你的 TODO 列表里，直接放这儿就行了<br/><br/><br/><b>2. 使用一个句子来描述你要测试的行为, 而不是简单的重复被测试的接口名</b>, 比如一个<a href='http://github.com/lidaobing/douban-ruby/blob/eab86e70f2bfce9c2a585047cebc46858c686558/spec/douban/authorize_spec.rb#L125'>典型的测试</a>: <br/><font face='monospace'>it "should return [Miniblog] with different id" do<br/></font>其中的 "should return [Miniblog] with different id" 就是这个测试的描述<br/><br/><b>3. 多级的 context, 便于将类的行为分到多个组, 同时每个组可以有不同的上下文环境(setUp+tearDown)</b>, 比如一个 xml parser, 如下所示的测试代码可以把行为分为两组，在遇到合法数据时的行为以及遇到非法数据时的行为<br/><br/>describe XmlParser do<br/>  context "with valid data" do<br/>    before do<br/>      @valid_data = "&lt;a&gt;123&lt;/a&gt;"<br/>    end<br/>    ...<br/>  end<br/>  context "with invalid data" do<br/>    before do<br/><br/>      @invalid_data = "&lt;a&gt;123&lt;/b&gt;"<br/><br/>    end<br/><br/>    ...<br/><br/>  end   <br/>end<br/><br/><b>4. 支持自动文档化</b>, 在1里已经可以看到 spec 支持生成一个简略的文档来描述你的对象, 下面是一个比较长的例子用于描述 Douban::Authorize 的功能, 树状的结构把类的功能分到了多个小组<br/><img src='http://images.cnblogs.com/cnblogs_com/lidaobing/Screenshot-Yakuake.png' style='max-width: 800px;'/><br/><br/><b>5. 表述更接近自然语言的习惯</b>, 比如 xUnit 通常使用 assertEqual(a, 1), 而 rspec 经常使用 a.should == 1<br/><br/>相对于 TDD 来说, 这些都不是什么革命性的突破。但是思路的转变，能够让你的开发更流畅。<br/><br/>首先你在设计时就可以开始写测试代码, 在开发完成后可以通过 rspec 生成的文档来快速浏览你是否完成了所有特性。这些性质都能让测试驱动开发更容易推广。从我的工作经验来看, 由于种种原因 (比如没有迭代周期, 缺乏 code review 制度, 没有硬指标的覆盖率要求...), 大家的测试代码写得很少。而在 rspec 的帮助下, 直接看 rspec 生成的文档就可以督促大家补全测试。<br/><br/>参考资料<br/><br/>[1] <a href='http://book.douban.com/subject/3603693/'>The RSpec Book</a><h1/></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/6324560-3087390946560023146?l=lidaobing.blogspot.com' alt='' /></div>
