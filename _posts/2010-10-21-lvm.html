---
layout: post
name: lvm
title: LVM (更新)
date: 2010-10-21 22:18:00.000000000 +08:00
categories:
- linux
- lvm
permalink: /2010/10/lvm.html
---
<p>原始版本: <a href="http://hi.baidu.com/lidaobing/blog/item/9509a344ed416a87b3b7dc2a.html">http://hi.baidu.com/lidaobing/blog/item/9509a344ed416a87b3b7dc2a.html</a></p><br /><p><span>updated: ext2resize 不再可用，换到 resize2fs</span></p><br /><h2><span class="Apple-style-span" style="font-size: large;">它是什么？</span></h2><br /><p>LVM（逻辑卷管理）能将多个储存设备(包括分区，RAID设备等)合并成为一个新的储存设备。在这设备上可以建立多个分区。他支持动态调整分区大小，动态添加或删除底层设备。</p><br /><h2><span>安装</span></h2><br /><blockquote><br /><p>sudo apt-get install lvm2<br />sudo apt-get install e2fsprogs</p><br /></blockquote><br /><h2><span>创建</span></h2><br /><p>LVM 可以在磁盘的分区或者<a href="http://kslabs.wikidot.com/raid">RAID</a>上的分区(如/dev/md0)上创建</p><br /><div class="code"><br /><pre><code># pvcreate /dev/sdb /dev/sdc # 格式化分区为LVM格式<br /># vgcreate vg0 /dev/sdb /dev/sdc # 创建volume group<br /># vgdisplay vg0 # 显示volume group 信息<br /># apt-get install dmraid # 安装raid device map<br /># lvcreate -L 500G -n vol1 vg0 # 创建逻辑卷<br /># mke2fs -j /dev/vg0/vol1 # 在逻辑卷上创建 ext3 分区<br /># mount /dev/vg0/vol1 /mount/path</code></pre><br /></div><br /><h2><span>扩容 (无须停机)</span></h2><br /><div class="code"><br /><pre><code># pvcreate /dev/sdd<br /># vgextend vg0 /dev/sdd<br /># lvextend -l +100%FREE /dev/vg0/vol1<br /># resize2fs -p /dev/vg0/vol1</code></pre><br /></div><br /><h2><span>磁盘损坏</span></h2><br /><h3><span>还有额外的地方可以连接新的硬盘 (无须停机)</span></h3><br /><p>比如 /dev/sdb 损坏，接入的新硬盘叫 /dev/sde</p><br /><div class="code"><br /><pre><code># pvcreate /dev/sde # 格式化新硬盘<br /># vgextend vg0 /dev/sde # 添加新硬盘到卷组<br /># pvmove /dev/sda /dev/sde # 移动数据<br /># vgreduce vg0 /dev/sda # 卸载硬盘</code></pre><br /></div><br /><h3><span>没有额外的地方可以连接新硬盘</span></h3><br /><p>需要先缩小分区至可容纳在剩余的硬盘上</p><br /><div class="code"><br /><pre><code># pvmove /dev/sda # 移动数据至同组的其他硬盘<br /># vgreduce vg0 /dev/sda # 卸载硬盘<br /># 更换硬盘<br /># pvcreate /dev/sda<br /># vgextend vg0 /dev/sda<br /># 接上面的扩容步骤</code></pre><br /></div><br /><p> </p><br /><h2><span>参考文献</span></h2><br /><ul><br /><li>《Linux Administration Handbook》 2nd Ed., Chapter 7</li><br /><li>A Beginner's Guide To LVM: <a href="http://www.howtoforge.com/linux_lvm">http://www.howtoforge.com/linux_lvm<br /></a></li><br /></ul><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/6324560-1547851971720715606?l=lidaobing.blogspot.com' alt='' /></div>
