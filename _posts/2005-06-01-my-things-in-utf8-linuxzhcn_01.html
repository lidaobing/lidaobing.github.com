---
layout: post
name: my-things-in-utf8-linuxzhcn_01
title: My things in UTF8
date: 2005-06-01 21:22:00.000000000 +08:00
categories:
- vim
- linux
- i18n
- emacs
permalink: /2005/06/my-things-in-utf8-linuxzhcn_01.html
---
<h1 id="top">My things in UTF8</h1>       <!-- Page published by Emacs Wiki begins here --> <p> 我准备把我的Linux平台的编码从zh_CN.GB2312改为zh_CN.UTF-8，希望能够一切 顺利。  </p>   <p> 我的系统是Debian/Linux, sid, 2.6。 </p><h2>基本配置</h2>  bash的设置没有改，.xsession是.xinitrc的软链接。 .xinitrc内容如下：    <pre class="example"># .xinitrc<br />source $HOME/.bash_profile<br /><br />LANG=zh_CN.UTF-8<br />LC_MESSAGES=en_US<br />LC_TIME=en_US<br />export LANG LC_MESSAGES LC_TIME<br /><br />export GDK_USE_XFT=1<br />export GTK_IM_MODULE='scim'<br />export XMODIFIERS="@im=SCIM"<br />scim -d<br /><br />xscreensaver -no-splash &amp;<br />esd &amp;amp;amp;<br /><br />icewmbg &amp;<br />icewmtray &amp;<br />exec icewm<br /></pre>   <h2>文件名</h2>  可以用convmv来转换    <pre>convmv -f gb2312 -t utf8 -r --notest *<br /></pre>   <p> -r表示包含所有子目录 不加--notest就表示只看看有什么需要转换的，不做实际转换  </p>   <h2>文件内容</h2>   <ul> <li>可以用iconv，不过我更喜欢用emacs.用emacs打开文件 <pre class="example">C-x &lt;return> f utf-8 &lt;return> C-x C-s</pre> 搞定。 </li><li>或者用vim(Thanks to fishy9@SMTH) <pre>:set fenc=utf8<br />:w<br /></pre> </li> </ul>   <h2>xterm</h2>  理论上uxterm, rxvt-unicode-ml, mlterm, gnome-terminal都应该支持的，但 似乎uxterm, rxvt总有莫名奇妙的问题，所以我用mlterm(gnome-terminal的粘 贴风格我不喜欢)    <h2>输入法</h2>   <h2>Emacs</h2>   <p> 只需加如下两句  </p>   <pre>(setq current-language-environment "Chinese-GB")<br />(prefer-coding-system 'utf-8)<br /></pre>   <p> 这时你用  </p>   <pre>C-h v coding-category-list<br /></pre>   <p> 可以看到coding-category-list等于  </p>   <pre>(coding-category-utf-8<br />coding-category-iso-8-2 coding-category-big5 coding-category-iso-7-else<br />coding-category-iso-8-1 coding-category-utf-16-be<br />coding-category-utf-16-le coding-category-iso-7-tight<br />coding-category-iso-7 coding-category-iso-8-else<br />coding-category-emacs-mule coding-category-raw-text<br />coding-category-sjis coding-category-ccl coding-category-binary)<br /></pre>   <p> 其中coding-category-iso-8-2就是chinese-iso-8bit，也就是gb2312  </p>   <h2>LaTeX</h2>  <h3>CJK</h3>  cjk-latex支持UTF8，但需要cyberb(debian没有提供)，只好拿ttf-arphic-gbsn00lp伪装一个。    <p> 首先安装tetex-bin, cjk-latex, ttf-arphic-gbsn00lp，然后运行脚本unisong  </p>   <p> unisong含两个文件，Makefile和c70song.fd  </p>   <p> Makefile: </p> <pre class="example">all: build<br />build:<br />   ln -s /usr/share/fonts/truetype/arphic/gbsn00lp.ttf unisong.ttf<br />   ttf2tfm unisong.ttf -w unisong@Unicode@ > unisong.log<br />   rm -f unisong.map<br />   for i in *.tfm; do        base=`basename $$i .tfm`;       echo "$${base} <$${base}.enc > unisong.map;     done<br /><br />install:<br />   install -d /usr/share/texmf/fonts/tfm/arphic/unisong/<br />   cp *.tfm /usr/share/texmf/fonts/tfm/arphic/unisong/<br />   install -d /usr/share/texmf/dvips/arphic/<br />   cp *.enc /usr/share/texmf/dvips/arphic/<br />   cp unisong.map /etc/texmf/dvips/<br />   cp unisong.map /usr/share/texmf/dvips/omega/<br />   cp unisong.ttf /usr/share/texmf/fonts/truetype/arphic/<br />   grep '^unisong@Unicode@ unisong.ttf' /etc/ttf2pk/ttfonts.map || echo "unisong@Unicode@ unisong.tff" >> /etc/ttf2pk/ttfonts.map<br />   cp -f c70song.fd /usr/share/texmf/tex/latex/CJK/UTF8/<br />   grep "^map +unisong.map" /etc/texmf/pdftex/pdftex.cfg || echo "map +unisong.map" >> /etc/texmf/pdftex/pdftex.cfg<br />   mktexlsr<br />clean:<br />   rm -f unisong*.tfm<br />   rm -f unisong*.enc<br />   rm -f unisong.map<br />   rm -f unisong.ttf<br />   rm -f unisong.log<br />.PHONY: build<br /></pre>   <p> c70song.fd(cjk-latex自带的c70song.fd，再将cyberb改成unisong就可以了):  </p>   <pre class="example">% This is the file c70song.fd of the CJK package<br />%   for using Asian logographs (Chinese/Japanese/Korean) with LaTeX2e<br />%<br />% created by Werner Lemberg<br />%<br />% Version 4.5.1 (17-Jun-2002)<br /><br />\def\fileversion{4.5.1}<br />\def\filedate{2002/06/17}<br />\ProvidesFile{c70song.fd}[\filedate\space\fileversion]<br /><br /><br />% character set: Unicode U+0080 - U+FFFD<br />% font encoding: Unicode<br /><br />\DeclareFontFamily{C70}{song}{\hyphenchar \font\m@ne}<br /><br />\DeclareFontShape{C70}{song}{m}{n}{<-> CJK * unisong}{}<br />\DeclareFontShape{C70}{song}{bx}{n}{<-> CJKb * unisong}{\CJKbold}<br /><br />\endinput<br /></pre>   <p> OK, make; su; make install就可以了  </p>   <p> 然后把你的latex文章转成UTF8编码，把\begin{CJK*}{GB}{song}改成 \begin{CJK*}{UTF8}{song}就可以了。  </p>   <h3>non-CJK</h3>  如果在英文文档中，你想直接输入<tt>Å</tt>，而不是去输入<tt>\AA</tt>的话， 可以使用latex-ucs来帮你实现。    <p> 安装完latex-ucs后，在tex文件的头部加入 </p> <pre class="example">\usepackage{ucs}<br />\usepackage[utf8]{inputenc}<br /></pre>  就可以在正文中输入任何unicode字符了。    <p> 如果在文件头加入 </p> <pre class="example">\usepackage[C10,T1]{fontenc}<br />\usepackage[cjkgb]{ucs}<br />\usepackage[utf8]{inputenc}<br /></pre>  那么输入中文也没有问题，不过就不能享受CJK带来的其他好处了。    <h2>FTP</h2>   <p> 很多FTP的文件名是GB2312编码的。解决方法有：  </p>   <ol> <li>用mozilla系列浏览器来访问FTP，可以自行设置编码。 </li><li>用lftp，在$HOME/.lftp/rc或/etc/lftp.conf文件中加入(感谢：yabozj AT    zju.edu.cn) <pre class="example">set ftp:charset "gbk"<br />set file:charset "UTF-8"<br /></pre> </li> </ol>   <h2>MP3 ID3 tag</h2>  xmms 里边一堆的乱码，看来是ID3的编码的问题，没办法，又写了一个脚本。注意，这个脚本依赖于pyid3lib, 你可以到 <a href="http://pyid3lib.sourceforge.net/">http://pyid3lib.sourceforge.net/</a> 下载，如果你用debian的话，可以直接用 apt-get install python-id3lib 安装    <pre class="example">#!/usr/bin/python<br /># mp3iconv.py<br />import os<br />import pyid3lib<br /><br />def texticonv(text, fcode, tcode):<br />try:<br />   text.decode(tcode)<br />except UnicodeDecodeError:<br />   try:<br />       newtext = text.decode(fcode)<br />   except UnicodeDecodeError:<br />       return False, None<br />   newtext = newtext.encode(tcode)<br />   return True, newtext<br />   os.rename(fname, newfname)<br />return False, None<br /><br /><br />def mp3iconv(fname, fcode='gb2312', tcode='utf8'):<br />tag = pyid3lib.tag(fname)<br />needupdate = False<br />for key in ['artist', 'title', 'album']:<br />   try:<br />       text = getattr(tag, key)<br />   except AttributeError:<br />       continue<br />   r, newtext = texticonv(text, fcode, tcode)<br />   if r:<br />       setattr(tag, key, newtext)<br />       needupdate = True<br />if needupdate:<br />   tag.update()<br /><br />def main():<br />import sys<br />assert len(sys.argv) > 1<br />for x in sys.argv[1:]:<br />   mp3iconv(x)<br /><br />if __name__ == '__main__':<br />main()<br /></pre><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/6324560-111763217425497832?l=lidaobing.blogspot.com' alt='' /></div>
